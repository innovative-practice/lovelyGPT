## 动画系统设计

在 WebGAL 新版本中，`动画`将会是一个 `PIXI.Ticker` 回调函数。而`变换`则是一个特殊的动画，只不过执行时间是0ms（在动画的第一帧就将舞台对象设置为终态状态）。

除此以外，因为并不是每一个舞台状态都包含动画相关的演出，所以为了在动画结束后也要保持舞台对象处于动画结束后被设置的位置（或应用的效果），还会有一个“内部变换”。

“内部变换”是一连串对指定 key 的舞台对象要应用的效果的记录。“内部变换”调用的时机一般是任何舞台对象动画结束后或舞台对象发生改变时。

为了防止“内部变换”影响舞台对象上动画的正常运行，WebGAL 舞台控制器有一个记录，可以记录下正在进行动画的舞台对象的 key，这些key会被锁定，无法应用变换。直到动画结束后，才会被解锁。

在任何动画结束后，动画执行程序都会将其作用的舞台对象的“终态”更新到对应的 key 的舞台对象的“内部变换”记录上。

## 不同类型的动画

在 WebGAL 中，可以作用在舞台对象上的动画，可以分为即时动画和退出动画。

即时动画会在脚本被调用的时候被立即触发。由于在没有任何动画被设置的情况下，舞台对象会预设一个渐入，所以如果想要自定义渐入动画，只需要在切换立绘/背景后立刻执行一个自定义的即时动画就可以了。

而退出动画将会在立绘/背景被移除时作用。默认的退出动画是一个渐出。如果想要应用一个退出动画，一个比较好的方式是在立绘退出时（在切换或关闭立绘时）为带有后缀 `-off` 的退出舞台对象设置一个即时动画。

所以，无论是进入还是退出动画，都应在 setFigure 或 setBg 后应用，无论这个命令是为了添加还是删除一个立绘。
